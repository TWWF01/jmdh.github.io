<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>云码</title>
    <style>
      :root{
        --page-bg:#f6f7fb;
        --card-bg:#ffffff;
        --text-1:#1f2937;
        --text-2:#6b7280;
        --primary:#3b82f6;
        --shadow-1:0 8px 20px rgba(0,0,0,0.06);
        --shadow-2:0 12px 28px rgba(0,0,0,0.10);
        --radius:16px;
      }
      html,body{height:100%;}
      body{
        font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
        background:var(--page-bg);
        margin:0;
        color:var(--text-1);
      }

      #app{
        width:100%;
        max-width:min(920px,100%);
        margin:0 auto;
        background:var(--card-bg);
        min-height:100vh;
        padding:clamp(12px,3vw,20px);
        box-shadow:none;
      }

      h1{ margin:0; text-align:center; font-weight:800; letter-spacing:2px; }
      .underline{ width:80%; height:2px; background:rgba(0,0,0,0.12); margin:10px auto 14px; border-radius:2px; }

      #todesk{ margin-top:6px; }
      .form-card{ background:#fff; border-radius:var(--radius); box-shadow:var(--shadow-1); padding:14px 14px 6px; }
      .form-row{ display:grid; grid-template-columns:96px 1fr; align-items:center; gap:10px; margin-bottom:10px; }
      .form-row span{ color:var(--text-2); }
      .input{ width:100%; height:40px; border:1px solid #e5e7eb; border-radius:10px; padding:0 12px; outline:none; transition:border-color .15s ease; }
      .input:focus{ border-color:var(--primary); box-shadow:0 0 0 3px rgba(59,130,246,.15); }

      .btn-row{ display:flex; gap:10px; padding:10px 0 2px; }
      .btn{ height:40px; padding:0 14px; border:none; border-radius:999px; background:var(--primary); color:#fff; cursor:pointer; box-shadow:var(--shadow-1); transition:transform .06s ease, box-shadow .18s ease, background .18s; }
      .btn.secondary{ background:#111827; }
      .btn:active{ transform:translateY(1px); box-shadow:0 4px 12px rgba(0,0,0,.12); }

      .info-card{ background:#fff; border-radius:var(--radius); box-shadow:var(--shadow-1); padding:12px; margin-top:12px; overflow:auto; }
      table{ width:100%; border-collapse:collapse; }
      th,td{ padding:10px; text-align:center; border-bottom:1px solid #f1f5f9; color:var(--text-1); }
      th{ color:#111827; background:#f8fafc; position:sticky; top:0; z-index:1; }
      tr:hover td{ background:#fafafa; }

      .hint{ color:var(--text-2); font-size:13px; margin-top:10px; }

      /* 小屏改为列式（卡片）展示 */
      @media (max-width: 720px){
        thead{ display:none; }
        table, tbody, tr, td{ display:block; width:100%; }
        tbody tr{ background:#fff; border-radius:12px; box-shadow:var(--shadow-1); margin:10px 0; padding:4px 0; }
        tbody td{ display:flex; justify-content:space-between; align-items:center; padding:12px 14px; border-bottom:1px solid #f1f5f9; text-align:left; }
        tbody td:last-child{ border-bottom:none; }
        tbody td::before{ content: attr(data-label); font-weight:700; color:#111827; margin-right:12px; }
      }
    </style>
</head>
<body>
  <div id="app">
    <h1>信息接收</h1>
    <div class="underline"></div>
    <div id="todesk" >
      <div class="form-card">
        <div class="form-row"><span>项目名称</span><input class="input" type="text" value="Todek云电脑" readonly></div>
        <div class="form-row"><span>手机号</span><input class="input" type="text" v-model="phone" placeholder="输入我给的号码"></div>
        <div class="btn-row">
          <button class="btn" @click="getphone(811867)">获取号码</button>
          <button class="btn secondary" @click="retable()">清空列表</button>
        </div>
      </div>
      <div class="info-card">
        <table>
          <thead>
            <tr>
              <th>项目ID</th>
              <th>区号</th>
              <th>运营商</th>
              <th>归属地</th>
              <th>号码</th>
              <th>验证码</th>
              <th>完整内容</th>
              <th>状态</th>
              <th>操作</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td data-label="项目ID">{{id}}</td>
              <td data-label="区号">{{country_qu}}</td>
              <td data-label="运营商">{{sp}}</td>
              <td data-label="归属地">{{phone_gsd}}</td>
              <td data-label="号码" @click="copy(phone)">{{ phone }}</td>
              <td data-label="验证码" @click="copy(yzm)">{{ yzm }}</td>
              <td data-label="完整内容">{{ info}}</td>
              <td data-label="状态">{{ now }}</td>
              <td data-label="操作">{{act}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <p class="hint">操作步骤：输入号码 → 点击获取号码 → 在手机/PC 端使用该号码注册 → 等待网页获取验证码 → 使用验证码登录。</p>
  </div>
    
    <script src="./vue.js"></script>
    <script src="./axios.min.js"></script>
    

    <script>
      const app = new Vue({
          el:'#app',
          data:{
            token:'PXfrofo3gm5hHKsW9JeTRwsHzuZ+yQFXzaIA4uWMcoenYIqqeQ4jiGVQ3Q0OxSycyxRSfUvUt8/EO8hjkym8E0NObVlhNK22TGIevDX1vJjQVAWxD1uuK1ufBNugIfBgsw39q/nFfVFB2DMZ3NkkQW5jFbh3sQ8leT6fpIQA7tc=',
            id:'',
            country_qu:'',
            sp:'',
            phone_gsd:'',
            phone:'',
            yzm:'',
            info:'',
            now:'',
            act:'',
          },
          methods:{
            copy(text){
              navigator.clipboard.writeText(text)
              .then(() => {
                    alert('已复制到剪切板！');
                })
                .catch(err => {
                    console.error('复制失败:', err);
                });
            },

            async getphone(id){
                if(this.phone.trim() === '' ){
                    alert('请输入正确的手机号');
                    return
                }
                const url = `https://api.sqhyw.net:90/api/get_mobile?token=${this.token}&project_id=${id}&phone_num=${this.phone}`;
                try {
                    const response = await axios.get(url);
                    const data = response.data;
                    // console.log(data);
                    if(data.message == "ok") {
                      this.id = id;
                      this.mobile = data.phone; // 提取手机号码
                      this.country_qu = data.operator; // 提取商店名称
                      this.country_name = '无'; // 提取国家名称
                      this.sp = '无';
                      this.phone_gsd = '无';
                      this.act = '获取验证码';
                    } else {
                      alert('获取手机号码失败1:');
                      return ;
                    }
                    
                }catch (error) {
                    console.error('获取手机号码失败2:', error);
                }
                    let num = 60;
                    const url1 = `https://api.sqhyw.net:90/api/get_message?token=${this.token}&project_id=${id}&phone_num=${this.phone}`;
                    // console.log(url1);
                    let response1 = await axios.get(url1);
                    let da = response1.data;
                    for(let i=1;i<=num;i++){
                      // console.log(i);
                      this.now = `${i*2}/120,正在获取验证码`;
                      await this.sleep(2000);
                      response1 = await axios.get(url1);
                      da = response1.data;
                      // console.log(da);
                      if(da.message == 'ok') break;
                    }

                    if(da.message == 'ok'){
                      this.yzm = da.code;
                      this.info = `【ToDesk云电脑公众号】${da.code}，此验证码用于您注册和登录ToDesk云电脑，5分钟内有效，请勿泄漏或转发他人。`;
                      this.now = '已获取到验证码';
                      this.act = '验证码获取成功';
                    }else{
                      this.act = '验证码获取失败';
                    }
                    
                    // 17112980135
            },

            sleep(ms) {
              return new Promise(resolve => setTimeout(resolve, ms));
            },
            
            retable(){
              this.id = '';
              this.phone = ''; // 提取手机号码
              this.country_qu = ''; // 提取商店名称
              this.country_name = ''; // 提取国家名称
              this.sp = '';
              this.phone_gsd = '';
              this.act = '';
              this.yzm = '';
              this.info = '';
            },

            async getinfo(phone,num){
              const url = `https://api.yayukj.cn/sms/?api=getMessage&token=${this.token}&sid=${this.id}&phone=`+phone;
              try {
                let response = await axios.get(url);
                let data = response.data;
              }catch (error) {
                console.error('获取手机号码失败2:', error);
              }
            }
          }
       })      
    </script>    
</body>
</html>
